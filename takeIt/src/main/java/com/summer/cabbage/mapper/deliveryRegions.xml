<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="deliveryRegions">
	<select id="selectNo" parameterType="int" resultType="DeliveryRegion">
		SELECT NO,PRODUCT_NO productNo,AREA_NO areaNo,PRICE,REGDATE	
		FROM delivery_regions
		WHERE no=#{no}	
	</select>
	<!-- 20210304 방 구독 상품 배송 옵션  -->
	<select id="selectDeliveryOptions" parameterType="int" resultType="DeliveryRegion">
		SELECT (SELECT name
				FROM regions
				WHERE (SELECT DISTINCT r.prior_no
						FROM delivery_regions dr, regions r, products p
						WHERE dr.area_no = r.no
						AND dr.product_no = p.no
						AND p.no = #{productNo}) = no) primaryRegionName , 
				r.name regionName, dr.price price, r.no
	
		FROM products p, delivery_regions dr, regions r
		WHERE p.no = dr.product_no
		AND dr.area_no = r.no
		AND p.no = #{productNo}
	</select>
	<!-- 03-04 송진현 추가  -->
	<select id="selectListRegion" parameterType="int" resultType="DeliveryRegion">
		SELECT (SELECT name
				FROM regions
				WHERE (SELECT DISTINCT r.prior_no
						FROM delivery_regions dr, regions r, products p
						WHERE dr.area_no = r.no
						AND dr.product_no = p.no
						AND p.no = #{productNo}) = no) primaryRegionName , 
				r.name regionName, dr.price price, r.no
	
		FROM products p, delivery_regions dr, regions r
		WHERE p.no = dr.product_no
		AND dr.area_no = r.no
		AND p.no = #{productNo}
	</select>
	
	<!-- 구독등록하기 -->
	<insert id="insertDeliveryRegions" parameterType="DeliveryRegion">
		INSERT INTO delivery_regions(NO, PRODUCT_NO, AREA_NO, PRICE, REGDATE)
		VALUES(delivery_regions_seq.nextval, #{productNo}, #{areaNo}, #{price}, systimestamp)
	</insert>
	<!-- 210304 박형우 -->
	
	
</mapper>

